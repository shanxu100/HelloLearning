# 统一各个模块中“对同一种依赖包”的管理

-------------

## 目标：

**1. 统一各个模块中“对同一种依赖包”的管理，并且实现在构建过程中动态选择所引入的依赖包的版本（release版和snapshot版）**

[具体实现（源代码)](./script/dependencies.gradle)

## 一、使用 dependencies.gradle 完成依赖统一管理 

### 1.1 问题场景

  ```java
  假设某个项目的结构如图所示：

  Project
      |
      |——subproject 1 ( 引入 okhttp 1.0  )
      |
      |——subproject 2 ( 引入 okhttp 1.0(-SNAPSHOT) )
      |
      |      
      |——subproject N ( 引入 okhttp 1.0  )
  ```
在根项目中有若干个子项目，并且每个子项目都引入了okhttp 1.0 。**若某一天决定使用okhttp 2.0 ，那么就需要去每一个subproject中依次修改 okhttp的引用；或者在本地测试时，需用引入snapshot类型的依赖；发布版本时需要引入release类型的依赖。** 在这个过程中很容易遗漏或者写错。

### 1.2 使用步骤

- **步骤1：**

  - 复制 **dependencies.gradle** 文件到项目根目录
  - 在项目根目录的 **build.gradle** 文件中添加以下代码
    ```Java
    subprojects {
            apply from: rootProject.getRootDir().path + '/dependencies.gradle'
        }
    ```

- **步骤2：**

  - 在dependencies.gradle中统一定义依赖。示例代码：
  ```Java
  ext {
      deps = [:]

      //TODO 第三方库在这里补充，方便多个模块对引用的管理

      //使用wrapDeps()包装的依赖可以动态选择release版本或者snapshot版本
      deps.dynamicfeature = wrapDeps('com.example.mylib:myname:1.0.8.300-SNAPSHOT')

      //不使用wrapDeps()包装的依赖，该是什么就是什么
      deps.okhttp = 'com.squareup.okhttp3:okhttp:4.1.0'
  }
  ```
  - **wrapDeps()** 方法可以对添加的依赖进行包装。达到的效果是：
    1. 在 **本地调试** 的时候，无论引入的依赖为release和snapshot版本，则项目就加载对应版本的依赖
    2. **上传到服务器自动构建** 的时候，根据参数-Psdkactive=release决定，将snapshot版本的依赖转成release版本 ***（注：若自动构建的过程中没有添加该参数，则该函数不对依赖做任何处理。效果同 “本地调试” 一样，写哪个版本就用哪个版本）***

- **步骤3：**

  - 在项目中各个模块的 **build.gradle** 中添加需要的依赖
  ```Java
  dependencies {
      // 不用使用 implementation com.squareup.okhttp3:okhttp:4.1.0 这种添加方式
      implementation deps.okhttp
  }
  ```

### 1.3 优点举例：
1. 使用 dependencies.gradle 后，当需要修改或升级依赖时，只需要一个文件就可以完成全局修改，并且可以在构建过程中动态选择所引入的依赖包的版本（release版和snapshot版）

---------------



